@page "/user/teacherlogin"
@layout LoginLayout
@using MudBlazor;
@using UMS.Client.Core.Enums
@using UMS.Client.Dtos.Shared
@using UMS.Client.Business.Interface.Shared

@inject ILocalStorageService LocalStorageService
@inject NavigationManager NavigationManager
@inject IAuthenticationService AuthenticationService
@inject IDialogService DialogService
@inject ISnackbar Snackbar


<div class="page">
  <div class="container">
    <div class="left">
      <div class="login">Image</div>
      <div class="eula">By logging in you agree to the ridiculously long terms that you didn't bother to read</div>
    </div>
    <div class="right">
      <div class="form">
         <MudTabs  Elevation="4" Rounded="true" Centered="true" Color="@Color.Primary">
            <MudTabPanel Text="Tab One">
                <MudText>
                </MudText>
            </MudTabPanel>
            <MudTabPanel Text="Tab Two">
                <MudText>Content Two</MudText>
            </MudTabPanel>
        </MudTabs>
      </div>
    </div>
  </div>
</div>


<!--

<div class="wrapper col-xl-8">
    <div class="card customBorder">
        <div>
            <h2 class="card-header text-center">User Login</h2>
        </div>
        <div class="card-body">
            <EditForm Model="@model" OnValidSubmit="OnValidSubmit">
                <DataAnnotationsValidator />
                <div class="form-group input-container">
                      <i class="fa fa-user icon"></i>
                    <InputText placeholder="Username" @bind-Value="model.Username" class="input-field"/>
                    <ValidationMessage For="@(() => model.Username)" />
                </div>
                <div class="form-group input-container">
                        <i class="fa fa-key icon"></i>
                    <InputText placeholder="Password" @bind-Value="model.Password" type="password" class="input-field" />
                    <ValidationMessage For="@(() => model.Password)" />
                </div>
                <br />
                <button disabled="@loading" class="btn btn-danger">
                    @if (loading)
                    {
                        <span class="spinner-border spinner-border-sm mr-1"></span>
                    }
                    <i style="margin-right:5px;" class="fas fa-sign-in-alt"></i>Login
                </button>
            </EditForm>
        </div>
    </div>
</div>

-->
@code {

    private LoginDto model = new LoginDto();
    private bool loading;

    private async void OnValidSubmit()
    {
        Console.WriteLine(model.Username + " - "+ model.Password);
        loading = true;
        try
        {
            await LocalStorageService.SetApplicationType(ApplicationType.TeacherPanel);
            var response = await AuthenticationService.TeacherAuthenticateViaPassword(model);
            if (response.Success)
            {
                NavigationManager.NavigateTo("/");
            }
            else
            {
                if (response.ErrorCode == ErrorCode.InvalidUsernameOrPassword)
                {
                    Snackbar.Add("Invalid Username Or Password", Severity.Error, options => options.Onclick = snackbar => Task.CompletedTask);
                }
                loading = false;
                StateHasChanged();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
            Snackbar.Add("Error" + ex.Message, Severity.Error, options => options.Onclick = snackbar => Task.CompletedTask);
            loading = false;
            StateHasChanged();
        }
    }
}
